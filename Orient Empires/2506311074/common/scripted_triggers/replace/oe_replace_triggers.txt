######### TRAVELLING ##########################
is_landless_ruler = {
	is_ruler = yes
	NOT = { exists = capital_province }
}

is_available_allow_travelling = {
	is_alive = yes
	is_in_army = no
	is_imprisoned = no
	is_landless_ruler = no
	has_contagious_deadly_disease_trigger = no
	NOT = { has_trait = incapable }
	custom_description = {
		text = ALREADY_IN_ACTIVITY
		# CD ALERT: if you add anything to this criteria, be sure to update the custom loc key GetActivityName so the tooltip reads exactly why a character is unavailable
		NOR = {
			exists = involved_activity
			has_variable = homage_liege_scope
			has_character_flag = meditation_character_flag
			has_character_flag = petition_liege_character_flag
			has_character_flag = holding_court_character_flag
			is_being_visited_on_tour_strict = yes
		}
	}
	custom_description = {
		text = ALREADY_PLANNING_ACTIVITY
		NOT = { has_character_flag = planning_an_activity }
	}
	# Variable set within the adventure inspiration events
	NOT = { has_variable = gone_adventuring }
}

is_available_travelling = {
	is_alive = yes
	is_in_army = no
	is_imprisoned = no
	has_contagious_deadly_disease_trigger = no
	NOT = { has_trait = incapable }
	NOT = { has_variable = gone_adventuring }
	#TODO_CD_EP2 should this be localized?
	is_busy_in_events_unlocalised = no
	is_travelling = yes
	is_landless_ruler = no
}

is_available_for_activity_trigger = {
	NOT = { exists = involved_activity }
	is_adult = yes
	OR = {
		is_ai = no
		is_busy_in_events_unlocalised = no
	}
	is_at_war = no
	is_imprisoned = no
	is_landless_ruler = no
	is_healthy = yes
	NOR = {
		exists = var:booked_for_a_party
		exists = var:engaged_in_single_combat
	}
}

is_available_for_child_activity_trigger = {
	NOT = { exists = involved_activity }
	is_adult = no
	age >= 4
	OR = {
		is_ai = no
		is_busy_in_events_unlocalised = no
	}
	is_at_war = no
	is_imprisoned = no
	is_landless_ruler = no
	is_healthy = yes
	NOT = { exists = var:booked_for_a_party }
}
#####################################################################

can_be_councillor_basics_trigger = {
	is_capable_adult = yes
	is_imprisoned = no
	is_at_war_with_liege = no
	NOT = { has_title = title:d_gosho }
	trigger_if = {
		limit = { has_variable = block_hire_councillor }
		NOT = { var:block_hire_councillor = liege }
	}
}

######################################################################
# Government
######################################################################

building_requirement_tribal_ulus = {
	scope:holder = {
		OR = {
			government_has_flag = government_is_tribal
			government_has_flag = government_is_ulus
		}
	}
}

can_be_marshal_trigger = {
	can_be_councillor_basics_trigger = yes
	NOT = { has_council_position = councillor_spouse }
	NAND = {
		$COURT_OWNER$ = { is_oe_imperial_government_trigger = yes }
		is_legion_government_trigger = yes
	}
	OR = {
		is_ruler = yes
		AND = {
			is_female = yes
			$COURT_OWNER$.faith = { NOT = { has_doctrine_parameter = male_dominated_council } }
		}
		AND = {
			is_male = yes
			$COURT_OWNER$.faith = { NOT = { has_doctrine_parameter = female_dominated_council } }
		}
		AND = {
			has_trait = shieldmaiden
			$COURT_OWNER$.culture = { has_cultural_parameter = has_access_to_shieldmaidens }
		}
	}
}

######################################################################
# interaction
######################################################################

title_revocation_is_tyrannical_trigger = {
	NOR = {
		has_revoke_title_reason = scope:recipient
		has_claim_on = scope:landed_title
		AND = {
			government_has_flag = government_is_celestial
			has_primary_title = title:e_celestia
			scope:recipient = {
				is_bureau_government_trigger = yes
			}
		}
		faith = {
			scope:recipient = {
				NOT = { vassal_contract_has_flag = religiously_protected }
			}
			OR = {
				AND = {								
					has_doctrine_parameter = pluralism_righteous_revocation_tyranny_reduced
					faith_hostility_level = {
						target = scope:recipient.faith
						value = faith_evil_level
					}
				}
				AND = {								
					has_doctrine_parameter = pluralism_fundamentalist_revocation_tyranny_minimal
					faith_hostility_level = {
						target = scope:recipient.faith
						value >= faith_hostile_level
					}
				}
			}
		}
	}
}

vassal_revocation_is_tyrannical_trigger = {
	NOR = {
		has_revoke_title_reason = scope:recipient
		faith = {
			OR = {
				AND = {								
					has_doctrine_parameter = pluralism_righteous_revocation_tyranny_reduced
					faith_hostility_level = {
						target = scope:recipient.faith
						value = faith_evil_level
					}
				}
				AND = {								
					has_doctrine_parameter = pluralism_fundamentalist_revocation_tyranny_minimal
					faith_hostility_level = {
						target = scope:recipient.faith
						value >= faith_hostile_level
					}
				}
			}
		}
		AND = {
			government_has_flag = government_is_celestial
			has_primary_title = title:e_celestia
			scope:recipient = {
				is_bureau_government_trigger = yes
			}
		}
	}
}

# Marriage
could_marry_character_trigger = {
	save_temporary_scope_as = can_marry_check
	can_marry_common_trigger = yes
	$CHARACTER$ = { can_marry_common_trigger = yes }
	#Opposite genders if you don't have accepted same-sex marriage game rule enabled and your faith supports it
	trigger_if = {
		limit = { #If you're someone's courtier, your liege can marry you anyway
			NOT = { is_courtier_of = $CHARACTER$ }
			allowed_to_marry_same_sex_trigger = no
		}
		sex_opposite_of = $CHARACTER$
	}
	trigger_if = {
		limit = { #If you're someone's courtier, your liege can marry you anyway
			$CHARACTER$ = { NOT = { is_courtier_of = scope:can_marry_check } }
			$CHARACTER$ = { allowed_to_marry_same_sex_trigger = no }
		}
		sex_opposite_of = $CHARACTER$
	}
	trigger_if = {
		limit = {
			is_courtier_of = $CHARACTER$
			$CHARACTER$ = { allowed_to_marry_same_sex_trigger = no }
		}
		sex_opposite_of = $CHARACTER$
	}
	trigger_if = {
		limit = {
			$CHARACTER$ = { is_courtier_of = scope:can_marry_check }
			allowed_to_marry_same_sex_trigger = no
		}
		sex_opposite_of = $CHARACTER$
	}
	#Have you recently divorced this character?
	NOT = {
		has_opinion_modifier = {
			modifier = divorced_me_opinion
			target = $CHARACTER$
		}
	}
	#Faith hostility & consanguinity
	trigger_if = {
		limit = { NOT = { is_courtier_of = $CHARACTER$ } } #If you're someone's courtier, your liege can marry you anyway
		faith = {
			faith_allows_marriage_consanguinity_trigger = {
				CHARACTER_1 = scope:can_marry_check
				CHARACTER_2 = $CHARACTER$
			}
			#faith_hostility_level = {
			#	target = $CHARACTER$.faith
			#	value < faith_hostility_prevents_marriage_level
			#}
		}
	}
	trigger_if = {
		limit = { $CHARACTER$ = { NOT = { is_courtier_of = scope:can_marry_check } } } #If you're someone's courtier, your liege can marry you anyway
		$CHARACTER$.faith = {
			faith_allows_marriage_consanguinity_trigger = {
				CHARACTER_1 = scope:can_marry_check
				CHARACTER_2 = $CHARACTER$
			}
			#faith_hostility_level = {
			#	target = scope:can_marry_check.faith
			#	value < faith_hostility_prevents_marriage_level
			#}
		}
	}
	NOT = {
		scope:can_marry_check = { is_spouse_of = $CHARACTER$ }
	}
	NOT = {
		scope:can_marry_check = { is_parent_of = $CHARACTER$ }
	}
}

### Legal trigger list

can_change_single_heir_dynasty_house_succession_law_trigger = {
	trigger_if = {
		limit = {
			culture = { has_cultural_pillar = heritage_west_slavic }
			NOT = {
				has_realm_law_flag = can_change_succession_laws
			}
		}
		culture = {
			has_innovation = innovation_table_of_princes
		}
	}
	trigger_else_if = {
		limit = { realm_law_use_tribal_authority = yes }
		custom_description = {
			text = "has_tribal_law_allowing_succession_law_change"
			has_realm_law_flag = can_change_succession_laws
		}
	}
	trigger_else_if = {
		limit = { culture = { has_cultural_pillar = heritage_tunguse } }
		culture = {
			OR = {
				has_innovation = innovation_world_cathay
				has_cultural_parameter = unlock_maa_asia_tunguse_ss
			}
		}
	}
	trigger_else = {
		custom_description = {
			text = "has_crown_law_allowing_succession_law_change"
			has_realm_law_flag = can_change_succession_laws
		}
	}
	custom_description = {
		text = "no_powerful_vassal_with_negative_opinion"
		NOT = {
			any_vassal = {
				is_powerful_vassal = yes
				opposes_succession_law_change_trigger = yes
			}
		}
	}
}

######################################################################
# contract_obligation
######################################################################

#has_bp1_dlc_trigger = {
#	always = yes
#}

building_tea_plantation_requirement_terrain = {
	OR = {
		terrain = hills
		terrain = farmlands
		terrain = forest
	}
	geographical_region = world_tea_plantation
}
building_silk_plantation_requirement_terrain = {
	OR = {
		terrain = wetlands
		terrain = plains
		terrain = farmlands
		terrain = hills
		terrain = forest
	}
	geographical_region = world_silk_plantation
}
building_spice_plantation_requirement_terrain = {
	OR = {
		terrain = jungle
		terrain = plains
	}
	geographical_region = world_asia_southeast
}

### HUNT ###



hunt_animal_tiger_trigger = {
	OR = {
		geographical_region = world_asia
		geographical_region = world_steppe
		geographical_region = world_india
		geographical_region = world_burma
		geographical_region = world_middle_east_persia
	}
	OR = {
		terrain = jungle
		terrain = forest
		terrain = taiga
		terrain = mountains
		terrain = hills
	}
	NOR = {
		terrain = farmlands
		terrain = floodplains
	}
}

hunt_animal_leopard_trigger = {
	OR = {
		geographical_region = world_africa_north_west
		geographical_region = world_africa_east
		geographical_region = world_africa_west
		geographical_region = world_middle_east
		geographical_region = world_india
		geographical_region = world_burma
		geographical_region = world_asia
	}
	NOR = {
		terrain = farmlands
		terrain = floodplains
		terrain = desert_mountains
	}
}

hunt_animal_steppe_trigger = { # Saiga/etc.
	OR = {
		geographical_region = world_steppe
		geographical_region = world_steppe_tartaria
	}
	OR = {
		terrain = steppe
		terrain = hills
		terrain = desert
		terrain = wetlands
	}
}

title_revocation_is_tyrannical_trigger = {
	NOR = {
		has_revoke_title_reason = scope:recipient
		has_claim_on = scope:landed_title
		AND = {
			scope:recipient = { is_oe_landed_bureaucrat_trigger = yes }
			scope:actor = {
				OR = {
					is_independent_ruler = yes
					is_oe_imperial_official_trigger = yes
					has_strong_hook = scope:recipient
				}
			}
		}
		faith = {
			scope:recipient = {
				NOT = { vassal_contract_has_flag = religiously_protected}
			}
			OR = {
				AND = {								
					has_doctrine_parameter = pluralism_righteous_revocation_tyranny_reduced
					faith_hostility_level = {
						target = scope:recipient.faith
						value = faith_evil_level
					}
				}
				AND = {								
					has_doctrine_parameter = pluralism_fundamentalist_revocation_tyranny_minimal
					faith_hostility_level = {
						target = scope:recipient.faith
						value >= faith_hostile_level
					}
				}
			}
		}
	}
}

has_university_building_trigger = {
	OR = {
		has_building_or_higher = celestial_university
		has_building_or_higher = holy_site_dashuyuan_01
		has_building_or_higher = generic_university
		has_building_or_higher = al_azhar_university
		has_building_or_higher = sankore_university
		has_building_or_higher = siena_university
		has_building_or_higher = nalanda_university
	}
}


is_religious_studies_location = {
	OR = {
		has_building_or_higher = holy_site_cathedral_01
		has_building_or_higher = holy_site_mosque_01
		has_building_or_higher = holy_site_pagan_grand_temple_01
		has_building_or_higher = holy_site_indian_grand_temple_01
		has_building_or_higher = holy_site_other_grand_temple_01
		has_building_or_higher = holy_site_mahabodhi_temple_01
		has_building_or_higher = brihadeeswarar_temple_01
		has_building_or_higher = holy_site_cologne_cathedral_01
		has_building_or_higher = holy_site_canterbury_cathedral_01
		has_building_or_higher = temple_of_uppsala_01
		has_building_or_higher = lund_cathedral_01
		has_building_or_higher = notre_dame_01
		has_building_or_higher = holy_site_imam_ali_mosque_01
		has_building_or_higher = holy_site_great_mosque_of_mecca_01
		has_building_or_higher = holy_site_great_mosque_of_cordoba_01
		has_building_or_higher = holy_site_great_mosque_of_djenne_01
		has_building_or_higher = holy_site_great_mosque_of_samarra_01
		has_building_or_higher = holy_site_prophetic_mosque_01
		has_building_or_higher = shwedagon_pagoda_01
		has_building_or_higher = ananda_temple_01
		has_building_or_higher = the_friday_mosque_01
		has_building_or_higher = khajuraho_01
		has_building_or_higher = hagia_sophia_01
		has_building_or_higher = temple_in_jerusalem_01
		has_building_or_higher = holy_site_basilica_santiago_01
		
		#has_building_or_higher = holy_site_wenmiao_01
		has_building_or_higher = daminggong_01
		has_building_or_higher = kongmiao_01
		has_building_or_higher = longmenshiku_01
		has_building_or_higher = jiankanggong_1
		has_building_or_higher = pijiakehanbei
		has_building_or_higher = yungangshiku
		has_building_or_higher = mogaoku
		has_building_or_higher = subashifosi
		has_building_or_higher = rewakefosi
		has_building_or_higher = pabonka_hermitage_01
		has_building_or_higher = becp_special_manyuetai
		has_building_or_higher = becp_special_haiyinsi
		has_building_or_higher = becpe_special_falongsi
		has_building_or_higher = Angkor_01
		has_building_or_higher = borobudur_temple_01
	}
}

# Petition is still valid
petition_top_liege_valid_trigger = {
	is_alive = yes
	is_imprisoned = no
	has_variable = petition_liege_scope
	top_liege = var:petition_liege_scope
	var:petition_liege_scope = {
		is_imprisoned = no
		has_royal_court = yes
	}
}