# Catalyst Checkers

oe_check_catalyst_effect = {

	if = {
		limit = {
			$CHAR$ = {
				any_character_struggle = {
					involvement = involved
					activate_struggle_catalyst_secondary_character_involvement_involved_trigger = {
						CATALYST = $CATALYST$
						CHAR = $CHAR$
					}
				}
			}
		}
		$CHAR$ = {
			every_character_struggle = {
				involvement = involved
				limit = {
					activate_struggle_catalyst_secondary_character_involvement_involved_trigger = {
						CATALYST = $CATALYST$
						CHAR = $CHAR$
					}
				}
				activate_struggle_catalyst = {
					catalyst = $CATALYST$
					character = $CHAR$
				}
			}
		}
	}

}


oe_check_catalyst_oe_win_against_liege_effect = {

	if = {
		limit = {
			scope:loser = scope:winner.liege
		}
		oe_check_catalyst_effect = {
			CHAR = scope:winner
			CATALYST = catalyst_oe_win_against_liege
		}
	}

}


oe_check_catalyst_oe_start_any_war_effect = {

	if = {
		limit = {
			scope:attacker.primary_title.tier >= tier_duchy
			scope:defender.primary_title.tier >= tier_duchy
		}
		oe_check_catalyst_effect = {
			CHAR = scope:attacker
			CATALYST = catalyst_oe_start_any_war
		}
	}

}


oe_check_catalyst_oe_convert_to_local_faith_effect = {
	
	if = {
		limit = {
			is_landed = yes
			root.capital_province.faith = root.faith
		}
		oe_check_catalyst_effect = {
			CHAR = root
			CATALYST = catalyst_oe_convert_to_local_faith
		}
	}

}


oe_check_catalyst_oe_forced_conversion_effect = {
	
	if = {
		limit = {
			is_landed = yes
			NOT = { root.capital_province.faith = root.faith }
		}
		oe_check_catalyst_effect = {
			CHAR = root
			CATALYST = catalyst_oe_forced_conversion
		}
	}

}


oe_check_catalyst_oe_unnatural_death_effect = {
	
	if = {
		limit = {
			is_landed = yes
			exists = scope:killer
		}
		oe_check_catalyst_effect = {
			CHAR = root
			CATALYST = catalyst_oe_unnatural_death
		}
	}

}


oe_check_catalyst_oe_claim_throne_effect = {

	oe_check_catalyst_effect = {
		CHAR = scope:owner
		CATALYST = catalyst_oe_claim_throne
	}

}


oe_check_catalyst_oe_gain_higher_title_effect = {

	if = {
		limit = {
			scope:title.tier >= tier_county		# Old title must be at least County-tier
		}
		oe_check_catalyst_effect = {
			CHAR = root
			CATALYST = catalyst_oe_gain_higher_title
		}
	}

}


oe_check_catalyst_oe_grant_title_effect = {

	if = {
		limit = {
			scope:transfer_type = flag:granted
		}
		oe_check_catalyst_effect = {
			CHAR = scope:previous_holder
			CATALYST = catalyst_oe_grant_title
		}
	}

}


oe_check_catalyst_oe_vassalize_effect = {

	if = {
		limit = {
			NOT = { exists = scope:old_liege }	# New vassal was an independent ruler
		}
		oe_check_catalyst_effect = {
			CHAR = root
			CATALYST = catalyst_oe_vassalize
		}
	}

}


# Sengoku Struggle

struggle_tartaria_on_start_effect = {

}


struggle_tartaria_on_change_effect = {

}


struggle_tartaria_on_join_effect = {

	scope:character = {
		if = {
			limit = {
				is_ai = no
			}

			if = {
				limit = {
					root = { was_player_joined = scope:character }
				}

				if = {
					limit = {
						NOT = { has_character_flag = struggle_tartaria_intro_event_flag }
					}
					add_character_flag = struggle_tartaria_intro_event_flag
				}
			}

			trigger_event = {
				id = oe_struggle.0001
			}
		}
	}

}
