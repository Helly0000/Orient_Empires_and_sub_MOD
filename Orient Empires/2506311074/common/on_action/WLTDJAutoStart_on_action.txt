############# WLTDJAutoStart_on_action
# by 往来天地间 WangLaiTianDiJian
# WLTDJAutoStart

#WLTDJ20220514
#自动化无地角色修正 & 重复ID角色清理
#手动版无地角色修正 by Khrone


on_game_start = {
	on_actions = {
		WLTDJAutoStart_game_start_on_action

		east_history_fix_action
		xinzeng_dfwc_wudi_juese_actions
		Jingkang_Incident_action
	}
}


WLTDJAutoStart_game_start_on_action = {
	effect = {
		WLTDJAutoStart_fill_duchy_ruler_function_effect = { START_DATE = 882.1.1 END_DATE = 1039.1.1 WLTDJAutoStart_fill_duchy_region_and_title_trigger = WLTDJAutoStart_fill_duchy_type_01_region_and_title_trigger }
#只针对最高头衔是伯爵的独立统治者，且该伯爵领所在公国头衔尚未创建。若该伯爵领所在公国头衔已经被持有，则该公国内所有伯爵领都不会被调整

#下面两个选一个，不要同时用，自动生成的最高头衔等级分别为王国和帝国（如果要用，王国、帝国的触发条件不要重合，否则重合部分只会有一种效果生效）。
#所谓自动生成，是将符合条件的王国/帝国法理内的所有“公国”头衔持有者都变成该王国/帝国的封臣，注意，若该王国/帝国法理内有独立伯爵，则那些伯爵不会成为该王国/帝国持有者的封臣
#如果想要那些伯爵也成为封臣的话，可以先利用上面的自动填充公爵功能，让那些伯爵先成为某公爵的封臣
		WLTDJAutoStart_fill_kingdom_ruler_function_effect = { START_DATE = 882.1.1 END_DATE = 1200.1.1 WLTDJAutoStart_fill_kingdom_region_and_title_trigger = WLTDJAutoStart_fill_kingdom_type_01_region_and_title_trigger }
#		WLTDJAutoStart_fill_empire_ruler_function_effect = { START_DATE = 882.1.1 END_DATE = 751.1.1 WLTDJAutoStart_fill_empire_region_and_title_trigger = WLTDJAutoStart_fill_empire_type_01_region_and_title_trigger }


		#让直辖了一大堆伯爵领的国王或皇帝将法理首都以及实际首都所在公国外的、在LIEGE_TITLE法理内且由该统治者持有的所有直辖伯爵领，都自动按法理生成新的公爵/伯爵。可通过manipulated_title_tier来选择针对公国或伯爵领
		#higher_level_title可以让liege_title下只针对从属于higher_level_title法理的目标作出调整。higher_level_title与liege_title相同时，则为针对整个liege_title法理内都生效
		#WLTDJAutoStart_generated_rulers_become_independent_trigger表示让新生成的公爵或伯爵独立，WLTDJAutoStart_generated_rulers_not_become_independent_trigger表示让新生成的公爵或伯爵仍为封臣
		#理论上什么时候都可以启用，只要把涉及的日期和头衔设定好.复制上面这句，把两个日期、头衔名改掉，就可以拓展到各个剧本中需要这种特殊处理的其他势力。
		#注意，参数设定为针对公国时，若某个公国首都伯爵领已被某封臣持有，则前述调整不会生效。
		#生成统治者仍为封臣时，其政体会设定为与最高领主一致。
		# manipulated_title_tier设定为公国时，若公国头衔或公国首都由境外持有，则将公国内最高统治者直辖领地变为生成的一地伯爵
		# manipulated_title_tier设定为公国且某一个公设定为独立时，若历史文件中某伯爵领有持有者，且其不持有公国首都，且其不是公爵的封臣，则其不会独立


		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 867.1.1 END_DATE = 1200.1.1 LIEGE_TITLE = e_celestia higher_level_title = k_qianzhong manipulated_title_tier = tier_county generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_become_independent_trigger }  

		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 1120.1.1 END_DATE = 1122.1.1 LIEGE_TITLE = e_jurchen higher_level_title = k_udege manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_become_independent_trigger }

		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 857.1.1 END_DATE = 883.1.1 LIEGE_TITLE = d_zhenwu higher_level_title = c_mogols manipulated_title_tier = tier_county generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 857.1.1 END_DATE = 883.1.1 LIEGE_TITLE = d_zhenwu higher_level_title = c_tiandejun manipulated_title_tier = tier_county generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_become_independent_trigger }

		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 857.1.1 END_DATE = 1200.1.1 LIEGE_TITLE = e_celestia higher_level_title = c_lidong manipulated_title_tier = tier_county generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 857.1.1 END_DATE = 1200.1.1 LIEGE_TITLE = k_goryeo higher_level_title = d_danluo manipulated_title_tier = tier_county generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_become_independent_trigger }


		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 881.1.1 END_DATE = 1031.1.1 LIEGE_TITLE = e_arabia higher_level_title = e_arabia manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger } 

		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 960.1.1 END_DATE = 1200.1.1 LIEGE_TITLE = e_celestia higher_level_title = e_celestia manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger } 
	
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 864.1.1 END_DATE = 1200.1.1 LIEGE_TITLE = k_yamato higher_level_title = k_yamato manipulated_title_tier = tier_county generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 979.1.1 END_DATE = 1200.1.1 LIEGE_TITLE = e_cathay higher_level_title = e_mongolia manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 864.1.1 END_DATE = 1200.1.1 LIEGE_TITLE = k_goryeo higher_level_title = k_goryeo manipulated_title_tier = tier_county generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 864.1.1 END_DATE = 908.1.1 LIEGE_TITLE = k_silla higher_level_title = k_silla manipulated_title_tier = tier_county generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 864.1.1 END_DATE = 1200.1.1 LIEGE_TITLE = k_nanzhong higher_level_title = k_nanzhong manipulated_title_tier = tier_county generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }

		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 887.1.1 END_DATE = 1200.1.1 LIEGE_TITLE = k_chenla higher_level_title = k_chenla manipulated_title_tier = tier_county generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 887.1.1 END_DATE = 1200.1.1 LIEGE_TITLE = k_champa higher_level_title = k_champa manipulated_title_tier = tier_county generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }

		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 889.1.1 END_DATE = 978.1.1 LIEGE_TITLE = k_east_francia higher_level_title = k_east_francia manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 889.1.1 END_DATE = 1033.1.1 LIEGE_TITLE = e_byzantium higher_level_title = e_byzantium manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 889.1.1 END_DATE = 1031.1.1 LIEGE_TITLE = k_france higher_level_title = k_france manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 889.1.1 END_DATE = 1031.1.1 LIEGE_TITLE = k_england higher_level_title = k_england manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 889.1.1 END_DATE = 1033.1.1 LIEGE_TITLE = e_caspian-pontic_steppe higher_level_title = e_caspian-pontic_steppe manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }

		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 889.1.1 END_DATE = 1033.1.1 LIEGE_TITLE = k_novgorod higher_level_title = k_novgorod manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 889.1.1 END_DATE = 1033.1.1 LIEGE_TITLE = k_ruthenia higher_level_title = k_ruthenia manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 889.1.1 END_DATE = 1033.1.1 LIEGE_TITLE = k_white_rus higher_level_title = k_white_rus manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 889.1.1 END_DATE = 1033.1.1 LIEGE_TITLE = k_opolye higher_level_title = k_opolye manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }

		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 889.1.1 END_DATE = 1033.1.1 LIEGE_TITLE = k_denmark higher_level_title = k_denmark manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 889.1.1 END_DATE = 1033.1.1 LIEGE_TITLE = k_sweden higher_level_title = k_sweden manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
		WLTDJAutoStart_create_ruler_function_effect = { START_DATE = 889.1.1 END_DATE = 1033.1.1 LIEGE_TITLE = k_norway higher_level_title = k_norway manipulated_title_tier = tier_duchy generated_rulers_become_independent_or_not_trigger = WLTDJAutoStart_generated_rulers_not_become_independent_trigger }
	}
}

#自动化无地角色修正
east_history_fix_action = {
	effect = {
		every_ruler = {
			if = {
				limit = {
					NOR = {
						government_has_flag = government_is_theocracy
						government_has_flag = government_is_mercenary
						government_has_flag = government_is_republic
						government_has_flag = government_is_holy_order
						has_title = title:d_yungdrung_bon
					}
					is_ruler = yes
					exists = primary_title
					primary_title = {
						is_titular = no
						exists = title_capital_county
						tier > tier_county
						is_mercenary_company = no
						is_holy_order = no
					}
					is_theocratic_lessee = no
					any_held_title = {
						tier = tier_county
						count = 0
					}
				}
				save_temporary_scope_as = holder_fix
				primary_title.title_capital_county = {
					save_temporary_scope_as = capital_county_fix
				}
				if = {
					limit = {
						primary_title.title_capital_county.holder = {
							is_vassal_of = scope:holder_fix
						}
					}
					create_title_and_vassal_change = {
						type = usurped
						save_scope_as = change
						add_claim_on_loss = yes
					}
					scope:capital_county_fix = {
						change_title_holder_include_vassals = {
							holder = scope:holder_fix
							change = scope:change
						}
					}	
					resolve_title_and_vassal_change = scope:change
				}
				else = {
					destroy_title = primary_title
				}
			}
		}
		#消灭所有重复ID角色
		every_living_character = {
			if = {
				limit = {
					NOT = { has_trait = immortality }
					age > 860
				}
				death = natural
			}
		}
	}
}

#靖康之变
Jingkang_Incident_action = {
	trigger = {
		game_start_date > 1127.6.2
	}
	effect = {
		every_living_character = {
			limit = {
				OR = {
					this = character:217728
					father = character:217727
					father = character:217728
					is_close_family_of = character:217728
					any_parent = { is_close_family_of = character:217728 }
					any_child = { father = character:217728 }
				}
				NOR = {
					this = character:zhuojun_zhao_292
					is_child_of = character:zhuojun_zhao_292
					is_ai = no
				}
			}
			title:e_jurchen.holder = {
				imprison = {
					target = prev
					type = house_arrest 
				}
			}
		}
		
	}
}

#手动版无地角色修正 by Khrone
xinzeng_dfwc_wudi_juese_actions= {
	trigger = {
		any_ruler = {
			exists = primary_title
			any_held_title = {
				tier = tier_county
				count = 0
			}
		}
	}
	effect = {
		if = {
			limit = {
				game_start_date = 867.1.1
			}
			character:74031 = {
				get_title = title:c_mangyshlak
			}
			character:163132 = {
				get_title = title:c_palmyra
			}
			character:302686 = {
				get_title = title:c_chah
			}
			character:82259 = {
				get_title = title:c_krakowska
			}
			character:82237 = {
				get_title = title:c_kujawy
			}
			character:45106 = {
				get_title = title:c_abivard
			}
		}

		if = {
			limit = {
				game_start_date = 882.4.4
			}
			character:82237 = {
				get_title = title:c_kujawy
			}
			character:168415 = {
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:302688 = {
				get_title = title:c_chah
			}
			character:82259 = {
				get_title = title:c_krakowska
			}
			character:45106 = {
				get_title = title:c_abivard
			}
			character:7945 = {
				get_title = title:c_karnten
			}
			character:90102 = {
				get_title = title:c_strassburg
			}
			character:70475 = {
				get_title = title:c_abkhazia
			}
			character:1410990 = {
				get_title = title:c_uvs_nuur
			}
		}

		if = {
			limit = {
				game_start_date = 907.6.2
			}
			character:168418 = {
                add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:1404364 = { #冯翊观察使
                get_title = title:c_huazhou_pingyi
			}
			character:82308 = {
                add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:1400517 = { #邢磁节度使
                get_title = title:c_cizhou
			}
			character:127022 = {
                get_title = title:c_angouleme
			}
			character:1227575 = {
                get_title = title:c_vidzeme
			}
			character:159135 = {
                get_title = title:c_visegrad
			}
		}

		if = {
			limit = {
				game_start_date = 936.9.15
			}
			character:188852 = {
                get_title = title:c_qayaliq
			}
			character:1230260 = {
                get_title = title:c_yazd
			}
			character:82309 = {
                add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:1400890 = { #河阳节度使
                get_title = title:c_mengzhou
			}
			character:1227576 = {
                get_title = title:c_vidzeme
			}
			character:1404758 = { #武兴观察使
                get_title = title:c_wudu
			}
			character:168422 = {
                add_trait = bubonic_plague #得腺鼠疫爆掉
			}
		}

		if = {
			limit = {
				game_start_date = 956.11.30
			}
			character:langya_yan_110 = { #泰宁经略使
                get_title = title:c_yanzhou
			}
			character:82309 = {
                add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:159172 = {
                get_title = title:c_mosul
			}
			character:40238 = {
                get_title = title:c_angouleme
			}
			character:1900372 = { #新罗王
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:1500521 = {
                get_title = title:c_nicopolis
			}
			character:1227577 = {
				get_title = title:c_vidzeme
			}
			character:asturleonese0009 = {
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:168423 = {
               add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			
		}

		if = {
			limit = {
				game_start_date = 975.1.1
			}
			character:1900372 = { #新罗王
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:1227577 = {
				get_title = title:c_vidzeme
			}
			character:168568 = {
				get_title = title:c_juterbog
			}
			character:asturleonese0009 = {
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:728 = {
				get_title = title:c_vidin
			}
			character:168440 = {
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:82310 = {
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
		}

		if = {
			limit = {
				game_start_date = 1032.10.26
			}
			character:82311 = {
				get_title = title:c_opole
			}
			character:1227579 = {
				get_title = title:c_vidzeme
			}
			character:1240005 = {
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:74457 = {
				get_title = title:c_kalyani
			}
#			character:252012 = { #疑似苯教神权头衔（但不是神权制）
#				add_trait = bubonic_plague #得腺鼠疫爆掉
#			}
			character:pecheneg000005 = {
				get_title = title:c_odessa
			}
			character:baranis0089 = {
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:168466 = {
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			
		}

		if = {
			limit = {
				game_start_date = 1066.9.15
			}
			character:1240005 = {
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:1233364 = {
				get_title = title:c_ufa
			}
			character:806 = {
				get_title = title:c_turgay
			}
			character:1232032 = {
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:1232151 = {
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:chalukyas_of_lata_3 = {
				get_title = title:c_vadodara
			}
			character:144107 = {
				add_trait = bubonic_plague #得腺鼠疫爆掉
			}
			character:20641 = {
				get_title = title:c_odessa
			}
		}

		if = {
			limit = {
				game_start_date = 1121.3.7
			}
			#character:jinjiang_zeng_047 = { #浙西转运使
				#add_trait = bubonic_plague #得腺鼠疫爆掉
			#}
			character:143150 = {
				get_title = title:c_vidzeme
			}

			character:144606 = { #圣殿骑士团
			    add_trait = bubonic_plague #得腺鼠疫爆掉
		    }

			character:216517 = {
				get_title = title:c_guria
			}
			character:125401 = {
				get_title = title:c_turgay
			}

			character:147001 = { #医院骑士团
			    add_trait = bubonic_plague #得腺鼠疫爆掉
		    }

#			character:10041052 = { #鸟羽天皇
#			    add_trait = bubonic_plague #得腺鼠疫爆掉
#		    }
		}
	}
}