
##############律令契约修改有利值
# Requires local_var:<obligation_type> to be set for feudal obligations
# This = Person who's obligation we are checking
count_obligation_improvements_for_vassal = {
	value = 0
	# Levies and taxes are a linear scale, moving up adds and moving down subtracts
	# 封建制税兵
	if = {
		limit = { government_has_flag = government_is_feudal }
		if = {
			limit = {
				local_var:feudal_government_taxes != vassal_contract_obligation_level:feudal_government_taxes
			}
			add = {
				value = vassal_contract_obligation_level:feudal_government_taxes
				subtract = local_var:feudal_government_taxes
			}
		}
		if = {
			limit = {
				local_var:feudal_government_levies != vassal_contract_obligation_level:feudal_government_levies
			}
			add = {
				value = vassal_contract_obligation_level:feudal_government_levies
				subtract = local_var:feudal_government_levies
			}
		}
	}

	# 律令制税兵和特殊义务
	if = {
		limit = { government_has_flag = government_is_celestial }
		if = {
			limit = {
				local_var:imperial_government_taxes != vassal_contract_obligation_level:imperial_government_taxes
			}
			add = {
				value = vassal_contract_obligation_level:imperial_government_taxes
				subtract = local_var:imperial_government_taxes
			}
		}
		if = {
			limit = {
				local_var:imperial_government_levies != vassal_contract_obligation_level:imperial_government_levies
			}
			add = {
				value = vassal_contract_obligation_level:imperial_government_levies
				subtract = local_var:imperial_government_levies
			}
		}
		if = {
			limit = {
				local_var:special_imperial_contract != vassal_contract_obligation_level:special_imperial_contract
			}
			subtract = 3 #民州军府切换
		}
		if = {
			limit = {
				local_var:special_imperial_legion != vassal_contract_obligation_level:special_imperial_legion
			}
			if = {
				limit = { local_var:special_imperial_legion != 2 } #藩镇对领主大不利
				subtract = 3
			}
			else = {
				add = 1
			}
		}
		if = {
			limit = {
				local_var:special_imperial_bureau != vassal_contract_obligation_level:special_imperial_bureau
			}
			if = {
				limit = { NOT = { local_var:special_imperial_bureau != 0 } } #减税自治州对领主不利
				subtract = 1
			}
			else = {
				add = 1
			}
		}
		if = {
			limit = {
				local_var:special_imperial_royal != vassal_contract_obligation_level:special_imperial_royal
			}
			if = {
				limit = { local_var:special_imperial_royal != 1 } #藩王对领主不利
				subtract = 2
			}
			else = {
				add = 3
			}
		}
	}
	
	# Any non-default fine print contract takes subtracts one
	# special_contract intentionally has no effect
	# 原封建制特殊义务
	if = {
		limit = {
			OR = {
				government_has_flag = government_is_feudal
				government_has_flag = government_is_celestial
				government_has_flag = government_is_legion
			}
		}
		if = {
			limit = {
				local_var:fortification_rights != vassal_contract_obligation_level:fortification_rights
			}
			if = {
				limit = { local_var:fortification_rights != 0 }
				add = 1
			}
			else = {
				subtract = 1
			}
		}
		if = {
			limit = {
				local_var:coinage_rights != vassal_contract_obligation_level:coinage_rights
			}
			if = {
				limit = { local_var:coinage_rights != 0 }
				add = 1
			}
			else = {
				subtract = 1
			}
		}
		if = {
			limit = {
				local_var:succession_rights != vassal_contract_obligation_level:succession_rights
			}
			if = {
				limit = { local_var:succession_rights = 0 }
				add = 1
			}
			else = {
				subtract = 1
			}
		}
	}
	# 原氏族制特殊义务
	if = {
		limit = {
			OR = {
				government_has_flag = government_is_clan
				government_has_flag = government_is_legion
			}
		}
		if = {
			limit = {
				local_var:iqta_special_rights != vassal_contract_obligation_level:iqta_special_rights
			}
			if = {
				limit = { local_var:iqta_special_rights != 0 }
				add = 1
			}
			else = {
				subtract = 1
			}
		}
		if = {
			limit = {
				local_var:ghazi_special_rights != vassal_contract_obligation_level:ghazi_special_rights
			}
			if = {
				limit = { local_var:ghazi_special_rights != 0 }
				add = 1
			}
			else = {
				subtract = 1
			}
		}
	}
	##############（各种特殊义务）
	if = {
		limit = {
			local_var:religious_rights != vassal_contract_obligation_level:religious_rights
		}
		if = {
			limit = { local_var:religious_rights != 0 }
			add = 1
		}
		else = {
			subtract = 1
		}
	}
	if = {
		limit = {
			local_var:war_declaration_rights != vassal_contract_obligation_level:war_declaration_rights
		}
		if = {
			limit = { local_var:war_declaration_rights != 0 }
			add = 1
		}
		else = {
			subtract = 1
		}
	}
	if = {
		limit = {
			local_var:council_rights != vassal_contract_obligation_level:council_rights
		}
		if = {
			limit = { local_var:council_rights != 0 }
			add = 1
		}
		else = {
			subtract = 1
		}
	}
	if = {
		limit = {
			local_var:title_revocation_rights != vassal_contract_obligation_level:title_revocation_rights
		}
		if = {
			limit = { local_var:title_revocation_rights != 0 }
			add = 1
		}
		else = {
			subtract = 1
		}
	}
	if = {
		limit = {
			local_var:jizya_special_rights != vassal_contract_obligation_level:jizya_special_rights
		}
		if = {
			limit = { local_var:jizya_special_rights != 0 }
			add = 1
		}
		else = {
			subtract = 1
		}
	}
	if = {
		limit = {
			local_var:marriage_favor_rights != vassal_contract_obligation_level:marriage_favor_rights
		}
		if = {
			limit = { local_var:marriage_favor_rights != 0 }
			add = 1
		}
		else = {
			subtract = 1
		}
	}
}

count_total_obligation_changes = {
	value = 0
	if = {
		limit = { government_has_flag = government_is_feudal }
		if = {
			limit = {
				local_var:feudal_government_taxes != vassal_contract_obligation_level:feudal_government_taxes
			}
			add = 1
		}
		if = {
			limit = {
				local_var:feudal_government_levies != vassal_contract_obligation_level:feudal_government_levies
			}
			add = 1
		}
	}
##############律令制
	if = {
		limit = { government_has_flag = government_is_celestial }		
		if = {
			limit = {
				local_var:imperial_government_taxes != vassal_contract_obligation_level:imperial_government_taxes
			}
			add = 1
		}
		if = {
			limit = {
				local_var:imperial_government_levies != vassal_contract_obligation_level:imperial_government_levies
			}
			add = 1
		}
		if = {
			limit = {
				local_var:special_imperial_contract != vassal_contract_obligation_level:special_imperial_contract
			}
			add = 1
		}
		if = {
			limit = {
				local_var:special_imperial_legion != vassal_contract_obligation_level:special_imperial_legion
			}
			add = 1
		}
		if = {
			limit = {
				local_var:special_imperial_bureau != vassal_contract_obligation_level:special_imperial_bureau
			}
			add = 1
		}
		if = {
			limit = {
				local_var:special_imperial_royal != vassal_contract_obligation_level:special_imperial_royal
			}
			add = 1
		}
	}
##############
	if = {
		limit = {
			local_var:religious_rights != vassal_contract_obligation_level:religious_rights
		}
		add = 1
	}
	if = {
		limit = {
			local_var:war_declaration_rights != vassal_contract_obligation_level:war_declaration_rights
		}
		add = 1
	}
	if = {
		limit = {
			local_var:council_rights != vassal_contract_obligation_level:council_rights
		}
		add = 1
	}
	if = {
		limit = {
			local_var:title_revocation_rights != vassal_contract_obligation_level:title_revocation_rights
		}
		add = 1
	}
	if = {
		limit = {
			local_var:special_contract != vassal_contract_obligation_level:special_contract
		}
		add = 1
	}
	if = {
		limit = {
			OR = {
				government_has_flag = government_is_feudal
				government_has_flag = government_is_legion
			}
		}
		if = {
			limit = {
				local_var:fortification_rights != vassal_contract_obligation_level:fortification_rights
			}
			add = 1
		}
		if = {
			limit = {
				local_var:coinage_rights != vassal_contract_obligation_level:coinage_rights
			}
			add = 1
		}
		if = {
			limit = {
				local_var:succession_rights != vassal_contract_obligation_level:succession_rights
			}
			add = 1
		}
	}
	if = {
		limit = {
			OR = {
				government_has_flag = government_is_feudal
				government_has_flag = government_is_legion
			}
		}
		if = {
			limit = {
				local_var:iqta_special_rights != vassal_contract_obligation_level:iqta_special_rights
			}
			add = 1
		}
		if = {
			limit = {
				local_var:ghazi_special_rights != vassal_contract_obligation_level:ghazi_special_rights
			}
			add = 1
		}
	}
	if = {
		limit = {
			local_var:jizya_special_rights != vassal_contract_obligation_level:jizya_special_rights
		}
		add = 1
	}
	if = {
		limit = {
			local_var:marriage_favor_rights != vassal_contract_obligation_level:marriage_favor_rights
		}
		add = 1
	}
}