# Tags:
# rank_headgear: any headgear that signifies a certain title. crowns, pope hat etc.

headgear_base = {

	usage = game
	selection_behavior = weighted_random
	priority = 1

## SP2 ## 
	
	sp2_western_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = sp2_western_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 90
				has_dlc_feature = elegance_of_the_empire
				portrait_imperial_trigger = {
					CULTURE_INPUT = western
				}	
			}
			modifier = {
				add = 90
				has_dlc_feature = elegance_of_the_empire
				portrait_imperial_trigger = {
					CULTURE_INPUT = northern
				}	
			}
			modifier = {
				add = 90
				has_dlc_feature = elegance_of_the_empire
				OR = {
					portrait_royalty_trigger = {
						CULTURE_INPUT = western
					}	
					portrait_imperial_trigger = {
						CULTURE_INPUT = western
					}					
				}
				is_female = yes
			}
			modifier = {
				add = 90
				has_dlc_feature = elegance_of_the_empire
				OR = {
					portrait_royalty_trigger = {
						CULTURE_INPUT = northern
					}	
					portrait_imperial_trigger = {
						CULTURE_INPUT = northern
					}					
				}
				is_female = yes
			}
			#modifier = {
			#	factor = 0
			#	has_ep2_dlc_trigger = yes
			#	NOT = {
			#		portrait_era2_trigger = yes 
			#	}
			#}
		}
	}

	sp2_western_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = sp2_western_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				has_dlc_feature = elegance_of_the_empire
				portrait_high_nobles_headgear_trigger = {
					CULTURE_INPUT = western
				}	
			}
			modifier = {
				factor = 0
				has_ep2_dlc_trigger = yes
				NOR = {
					portrait_era2_trigger = yes 
					portrait_era3_trigger = yes
				}
			}
		}
	}


## DDE HRE ##

	dde_hre_commoners = {

		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = dde_hre_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 20
                portrait_commoner_clothing_trigger = {  
                    CULTURE_INPUT = dde_hre # CULTURE_INPUT gets added into the trigger referenced in 00_clothing_triggers.txt so it's important the input is a correct match to an existing culture trigger
                }
			}
		}
	}

	dde_hre_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = dde_hre_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			court_fashion_level_4_headgear_modifier = { INPUT_PARAMETER = dde_hre } # common/scripted_modifiers/00_portrait_modifiers.txt
			modifier = {
				add = 50
				portrait_low_nobles_clothing_trigger = {
					CULTURE_INPUT = dde_hre
				}
			}
            modifier = {
                factor = 0       # Should NOT show up if EP2 is active and we're not in the right era
                has_ep2_dlc_trigger = yes   
                NOR = { 
                	portrait_era3_trigger = yes 
                	portrait_era4_trigger = yes 
                } 
            }
		}
	}

	dde_hre_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = dde_hre_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				portrait_high_nobles_headgear_trigger = {
					CULTURE_INPUT = dde_hre
				}	
			}
            modifier = {
                factor = 0       # Should NOT show up if EP2 is active and we're not in the right era
                has_ep2_dlc_trigger = yes   
                NOR = { 
                	portrait_era3_trigger = yes 
                	portrait_era4_trigger = yes 
                } 
            }
		}
	}

	dde_hre_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = dde_hre_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				portrait_royalty_trigger = {
					CULTURE_INPUT = dde_hre
				}	
			}
            modifier = {
                factor = 0       # Should NOT show up if EP2 is active and we're not in the right era
                has_ep2_dlc_trigger = yes   
                NOR = { 
                	portrait_era3_trigger = yes 
                	portrait_era4_trigger = yes 
                } 
            }
		}
	}

	# Reichskrone
	dde_hre_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = dde_hre_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 100 # always pick the HRE crown over the western one
				portrait_reichskrone_trigger = yes
			}
		}
	}

## Western ##

	western_commoners = {

		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = western_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 80
				portrait_commoner_headgear_fallback_trigger = {
					CULTURE_INPUT = western
				}
				NOT = { has_ep2_dlc_trigger = yes }
			}
			modifier = {
				add = 20
				portrait_commoner_clothing_trigger = {
					CULTURE_INPUT = western
				}
				NOT = { has_ep2_dlc_trigger = yes }
			}
		}
	}

    ep2_western_era1_commoners = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = ep2_western_era1_common
                range = { 0 1 } # For the randomness to work correctly
            }
        }   
        weight = {
            base = 0
			modifier = {
				add = 80
				portrait_commoner_headgear_fallback_trigger = {
					CULTURE_INPUT = western
				}
				has_ep2_dlc_trigger = yes 
				portrait_era1_trigger = yes 
			}
            modifier = {
                add = 20
                portrait_commoner_clothing_trigger = { 
                    CULTURE_INPUT = western
                } 
                has_ep2_dlc_trigger = yes   
                portrait_era1_trigger = yes     
            }
        }
    }

    ep2_western_era2_commoners = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = western_common
                range = { 0 1 } # For the randomness to work correctly
            }
        }   
        weight = {
            base = 0
			modifier = {
				add = 80
				portrait_commoner_headgear_fallback_trigger = {
					CULTURE_INPUT = western
				}
				has_ep2_dlc_trigger = yes 
				portrait_era2_trigger = yes 
			}
            modifier = {
                add = 20
                portrait_commoner_clothing_trigger = { 
                    CULTURE_INPUT = western
                } 
                has_ep2_dlc_trigger = yes   
                portrait_era2_trigger = yes     
            }
        }
    }

    ep2_western_era3_commoners = {
        dna_modifiers = {
            accessory = {
                mode = add
                gene = headgear
                template = western_common
                range = { 0 1 } # For the randomness to work correctly
            }
        }   
        weight = {
            base = 0
			modifier = {
				add = 80
				portrait_commoner_headgear_fallback_trigger = {
					CULTURE_INPUT = western
				}
				has_ep2_dlc_trigger = yes 
				portrait_era3_trigger = yes 
			}
            modifier = {
                add = 20
                portrait_commoner_clothing_trigger = { 
                    CULTURE_INPUT = western
                } 
                has_ep2_dlc_trigger = yes   
                portrait_era3_trigger = yes     
            }
        }
    }

	western_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = western_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
		    modifier = {
		        add = 50
		        court_fashion_level_4_headgear_trigger = {
		            CULTURE_INPUT = western
		        }
		        has_ep2_dlc_trigger = yes 
		        portrait_era1_trigger = yes 
		    }
			modifier = {
				add = 50
                portrait_low_nobles_clothing_trigger = {  
                    CULTURE_INPUT = western 
                }
                NOT = { has_ep2_dlc_trigger = yes }
			}
		}
	}

	ep2_western_era1_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = ep2_western_era1_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
		    modifier = {
		        add = 50
		        court_fashion_level_4_headgear_trigger = {
		            CULTURE_INPUT = western
		        }
		        has_ep2_dlc_trigger = yes 
		        portrait_era1_trigger = yes 
		    }
			modifier = {
				add = 50
                portrait_low_nobles_clothing_trigger = {  
                    CULTURE_INPUT = western 
                }
                has_ep2_dlc_trigger = yes
                portrait_era1_trigger = yes  
			}
		}
	}

	ep2_western_era2_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = western_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
		    modifier = {
		        add = 50
		        court_fashion_level_4_headgear_trigger = {
		            CULTURE_INPUT = western
		        }
		        has_ep2_dlc_trigger = yes 
		        portrait_era1_trigger = yes 
		    }
			modifier = {
				add = 50
                portrait_low_nobles_clothing_trigger = {  
                    CULTURE_INPUT = western 
                }
                has_ep2_dlc_trigger = yes
                portrait_era2_trigger = yes  
			}
		}
	}

	ep2_western_era3_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = western_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
		    modifier = {
		        add = 50
		        court_fashion_level_4_headgear_trigger = {
		            CULTURE_INPUT = western
		        }
		        has_ep2_dlc_trigger = yes 
		        portrait_era1_trigger = yes 
		    }
			modifier = {
				add = 50
                portrait_low_nobles_clothing_trigger = {  
                    CULTURE_INPUT = western 
                }
                has_ep2_dlc_trigger = yes
                OR = {
                	portrait_era3_trigger = yes  
                	portrait_era4_trigger = yes  
                }
			}
		}
	}

	western_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = western_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_high_nobles_headgear_trigger = {  
                    CULTURE_INPUT = western 
                }
                NOT = { has_ep2_dlc_trigger = yes }
			}
		}
	}

	ep2_western_era1_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = ep2_western_era1_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_high_nobles_headgear_trigger = {  
                    CULTURE_INPUT = western 
                }
                has_ep2_dlc_trigger = yes
                portrait_era1_trigger = yes  
			}
		}
	}

	ep2_western_era2_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = western_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_high_nobles_headgear_trigger = {  
                    CULTURE_INPUT = western 
                }
                has_ep2_dlc_trigger = yes
                portrait_era2_trigger = yes  
			}
		}
	}

	ep2_western_era3_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = western_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_high_nobles_headgear_trigger = {  
                    CULTURE_INPUT = western 
                }
                has_ep2_dlc_trigger = yes
                OR = {
                	portrait_era3_trigger = yes  
                	portrait_era4_trigger = yes  
                }
			}
		}
	}

	western_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = western_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				portrait_royalty_trigger = {
					CULTURE_INPUT = western 
				}
				NOT = { has_ep2_dlc_trigger = yes }
			}
		}
	}

	ep1_western_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = ep1_western_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				portrait_royalty_trigger = {
					CULTURE_INPUT = western 
				}
			}
			modifier = {
				factor = 0
				NOT = {
					has_ep1_dlc_trigger = yes
				}
			}
		}
	}

	ep2_western_era1_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = ep2_western_era1_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_royalty_trigger = {  
                    CULTURE_INPUT = western 
                }
                has_ep2_dlc_trigger = yes
                portrait_era1_trigger = yes  
			}
		}
	}

	ep2_western_era2_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = western_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_royalty_trigger = {  
                    CULTURE_INPUT = western 
                }
                has_ep2_dlc_trigger = yes
                portrait_era2_trigger = yes  
			}
		}
	}

	ep2_western_era3_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = western_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_royalty_trigger = {  
                    CULTURE_INPUT = western 
                }
                has_ep2_dlc_trigger = yes
                OR = {
                	portrait_era3_trigger = yes
                	portrait_era4_trigger = yes
                }  
			}
		}
	}

	# Commented as it can create desync in multiplayer game
	#reward_western_royalty = {
	#	dna_modifiers = {
	#		accessory = {
	#			mode = add
	#			gene = headgear
	#			template = ep1_western_royalty
	#			range = { 0 1 } # For the randomness to work correctly
	#		}
	#	}
	#	weight = {
	#		base = 0
	#		modifier = {
	#			add = 50
	#			exists = this
	#			portrait_can_use_noble_headgear_trigger = yes
	#			OR = {
	#				AND = {
	#					OR = {
	#						highest_held_title_tier = tier_kingdom
	#						AND = { is_ruler = yes government_has_flag = government_is_theocracy }
	#						AND = {
	#							highest_held_title_tier = tier_empire
	#							portrait_northern_clothing_trigger = yes
	#							portrait_fp1_norse_clothing_trigger = no
	#						}
	#					}
	#					NOT = { AND = { is_ruler = yes government_has_flag = government_is_mercenary  } } # Blocked for mercenaries
	#					NOT = { government_has_flag = government_is_republic }
	#					OR = {
	#						portrait_western_clothing_trigger = yes
	#						AND = {
	#							portrait_northern_clothing_trigger = yes
	#							portrait_fp1_norse_clothing_trigger = no
	#						}
	#						AND = {
	#							portrait_fp1_norse_clothing_trigger = yes
	#							NOR = {
	#								government_has_flag = government_is_tribal
	#								religion = religion:germanic_religion
	#							}
	#						}
	#					}
	#				}
	#				AND = {
	#					exists = primary_spouse
	#					OR = {
	#						is_ruler = no
	#						highest_held_title_tier = tier_barony
	#					}
	#					primary_spouse = {
	#						OR = {
	#							highest_held_title_tier = tier_kingdom
	#							AND = { is_ruler = yes government_has_flag = government_is_theocracy }
	#							AND = {
	#								highest_held_title_tier = tier_empire
	#								portrait_northern_clothing_spouse_trigger = yes
	#								portrait_fp1_norse_clothing_spouse_trigger = no
	#							}
	#						}
	#						NOT = { AND = { is_ruler = yes government_has_flag = government_is_mercenary  } } # Blocked for mercenaries
	#						NOT = { government_has_flag = government_is_republic }
	#						OR = {
	#							portrait_western_clothing_spouse_trigger = yes
	#							AND = {
	#								portrait_northern_clothing_spouse_trigger = yes
	#								portrait_fp1_norse_clothing_spouse_trigger = no
	#							}
	#							AND = {
	#								portrait_fp1_norse_clothing_spouse_trigger = yes
	#								NOR = {
	#									government_has_flag = government_is_tribal
	#									religion = religion:germanic_religion
	#								}
	#							}
	#						}
	#					}
	#				}
	#			}
	#		}
	#		modifier = {
	#			factor = 0
	#			NOT = {
	#				has_reward_item = newsletter_crown
	#			}
	#		}
	#	}
	#}

	ep1_italian_royalty = { # The Iron Crown of Lombardy
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = ep1_italian_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				portrait_royalty_trigger = {
					CULTURE_INPUT = western 
				}
				culture = {
					has_cultural_pillar = heritage_latin
				}
				has_ep1_dlc_trigger = yes
			}
		}
	}

	western_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = western_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				portrait_imperial_trigger = {
					CULTURE_INPUT = western 
				}
				NOT = { has_ep2_dlc_trigger = yes }
			}
			modifier = {
				add = 50
				portrait_imperial_trigger = {
					CULTURE_INPUT = northern 
				}
				NOT = { has_ep2_dlc_trigger = yes }
			}
		}
	}

	ep2_western_era1_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = ep2_western_era1_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_imperial_trigger = {  
                    CULTURE_INPUT = western 
                }
                has_ep2_dlc_trigger = yes
                portrait_era1_trigger = yes  
			}
			modifier = {
				add = 50
                portrait_imperial_trigger = {  
                    CULTURE_INPUT = northern 
                }
                has_ep2_dlc_trigger = yes
                portrait_era1_trigger = yes  
			}
		}
	}

	ep2_western_era2_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = western_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_imperial_trigger = {  
                    CULTURE_INPUT = western 
                }
                has_ep2_dlc_trigger = yes
                OR = {
                	portrait_era2_trigger = yes
                	portrait_era3_trigger = yes
                }  
			}
			modifier = {
				add = 50
                portrait_imperial_trigger = {  
                    CULTURE_INPUT = northern 
                }
                has_ep2_dlc_trigger = yes
                OR = {
                	portrait_era2_trigger = yes
                	portrait_era3_trigger = yes
                }  
			}
		}
	}

	ep2_western_era4_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = western_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_imperial_trigger = {  
                    CULTURE_INPUT = western 
                }
                has_ep2_dlc_trigger = yes
                OR = {
                	portrait_era4_trigger = yes
                }  
			}
			modifier = {
				add = 50
                portrait_imperial_trigger = {  
                    CULTURE_INPUT = northern 
                }
                has_ep2_dlc_trigger = yes
                OR = {
                	portrait_era4_trigger = yes
                }  
			}
		}
	}

## Byzantine ##

	byzantine_commoners = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = byzantine_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 80
                portrait_commoner_headgear_fallback_trigger = {
                    CULTURE_INPUT = byzantine
                }
			}
			modifier = {
				add = 20
                portrait_commoner_clothing_trigger = {
                    CULTURE_INPUT = byzantine
                }
			}
		}
	}

	byzantine_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = byzantine_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			court_fashion_level_4_headgear_modifier = { INPUT_PARAMETER = byzantine } 
			modifier = {
				add = 50
                portrait_low_nobles_clothing_trigger = {  
                    CULTURE_INPUT = byzantine 
                }
			}
		}
	}

	byzantine_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = byzantine_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_high_nobles_headgear_trigger = {
                    CULTURE_INPUT = byzantine
                }   
			}
		}
	}

	byzantine_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = byzantine_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_royalty_trigger = {
                    CULTURE_INPUT = byzantine
                }   
			}
		}
	}

	byzantine_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = byzantine_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				portrait_imperial_trigger = {
                    CULTURE_INPUT = byzantine 
                }
			}
		}
	}

	ep1_byzantine_imperial = { # Crown of Justinian
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = ep1_byzantine_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				portrait_imperial_trigger = {
					CULTURE_INPUT = byzantine 
				}
			}
			modifier = {
				factor = 0
				NOT = {
					has_title = title:e_byzantium
				}
			}
			modifier = {
				factor = 0
				NOT = {
					has_ep1_dlc_trigger = yes
				}
			}
		}
	}

## INDIAN ##

	indian_commoners = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = indian_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 80
                portrait_commoner_headgear_fallback_trigger = {
                    CULTURE_INPUT = indian
                }
			}
			modifier = { # Non-european jesters should not use the jester hat
				add = 1000
				portrait_jester_trigger = {  
                    CULTURE_INPUT = indian 
                }
			}
			modifier = {
				add = 20
				portrait_commoner_clothing_trigger = {  
                    CULTURE_INPUT = indian 
                }
			}
		}
	}

	indian_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = indian_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			court_fashion_level_4_headgear_modifier = { INPUT_PARAMETER = indian } 
			modifier = {
				add = 50
                portrait_low_nobles_clothing_trigger = {  
                    CULTURE_INPUT = indian 
                }
			}
		}
	}

	indian_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = indian_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_high_nobles_headgear_trigger = {
                    CULTURE_INPUT = indian
                }   
			}
		}
	}

	indian_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = indian_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_royalty_trigger = {
                    CULTURE_INPUT = indian
                }   
			}
		}
	}

	ep1_indian_royalty = { 
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = ep1_indian_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 100
				portrait_royalty_trigger = {
					CULTURE_INPUT = indian
				}
				culture = {
					has_cultural_pillar = heritage_burman
				}
				has_ep1_dlc_trigger = yes
			}
		}
	}

	indian_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = indian_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_imperial_trigger = {
                    CULTURE_INPUT = indian 
                }
			}
		}
	}

	ep1_indian_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = ep1_indian_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 100
                portrait_imperial_trigger = {
                    CULTURE_INPUT = indian 
                }
				culture = {
					has_cultural_pillar = heritage_burman
				}
				has_ep1_dlc_trigger = yes
			}
		}
	}

## MENA ##

	mena_commoners = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = mena_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 80
                portrait_commoner_headgear_fallback_trigger = {
                    CULTURE_INPUT = mena
                }
			}
			modifier = { # Non-european jesters should not use the jester hat
				add = 1000
                portrait_jester_trigger = {  
                    CULTURE_INPUT = mena 
                }
			}
			modifier = {
				add = 20
                portrait_commoner_clothing_trigger = {
                    CULTURE_INPUT = mena
                }
			}
		}
	}

	mena_mayors = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = mena_low_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 60
				portrait_mayor_headgear_trigger = {
					CULTURE_INPUT = mena
				}
			}
		}
	}

	mena_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = mena_low_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
			court_fashion_level_4_headgear_modifier = { INPUT_PARAMETER = mena } 
			modifier = {
				add = 50
                portrait_low_nobles_clothing_trigger = {
                    CULTURE_INPUT = mena
                }
			}
		}
	}

	mena_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = mena_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}		
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_high_nobles_headgear_trigger = {
                    CULTURE_INPUT = mena
                }   
			}
		}
	}

	mena_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = mena_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}		
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_royalty_trigger = {
                    CULTURE_INPUT = mena
                }   
			}
		}
	}

	ep1_mena_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = ep1_mena_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}		
		weight = {
			base = 0
			modifier = {
				add = 100
                portrait_royalty_trigger = {
                    CULTURE_INPUT = mena 
                }
				culture = {
					has_cultural_pillar = heritage_east_african
				}
				religion = religion:islam_religion
				has_ep1_dlc_trigger = yes
			}
		}
	}

	mena_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = mena_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_imperial_nobles_headgear_trigger = {
                    CULTURE_INPUT = mena 
                }
			}
		}
	}

	ep1_persian_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = ep1_persian_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_imperial_nobles_headgear_trigger = {
                    CULTURE_INPUT = mena 
                }
                culture = {
                    has_cultural_pillar = heritage_iranian
                }
                has_ep1_dlc_trigger = yes
			}
		}
	}

## DDE ABBASID ##

	dde_abbasid_commoners = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = dde_abbasid_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 20
                portrait_commoner_clothing_trigger = {
                    CULTURE_INPUT = dde_abbasid
                }
			}
		}
	}

	dde_abbasid_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = dde_abbasid_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_high_nobles_headgear_trigger = {
                    CULTURE_INPUT = dde_abbasid
                } 
			}
		}
	}

	dde_abbasid_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = dde_abbasid_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_royalty_trigger = {
                    CULTURE_INPUT = dde_abbasid
                }  
			}
		}
	}

	dde_abbasid_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = dde_abbasid_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 100 # pick over mena
                portrait_imperial_trigger = {
                    CULTURE_INPUT = dde_abbasid 
                }
			}
		}
	}

## Steppe ##

	steppe_commoners = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = steppe_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 80
                portrait_commoner_headgear_fallback_trigger = {
                    CULTURE_INPUT = steppe
                }
			}
			modifier = { # Non-european jesters should not use the jester hat
				add = 1000
                portrait_jester_trigger = {  
                    CULTURE_INPUT = steppe 
                }
				NOR = {
					portrait_western_clothing_trigger = yes
					portrait_byzantine_clothing_trigger = yes
					portrait_northern_clothing_trigger = yes
				}
			}
			modifier = {
				add = 20
                portrait_commoner_clothing_trigger = {  
                    CULTURE_INPUT = steppe 
                }
			}
		}
	}

	steppe_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = steppe_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			court_fashion_level_4_headgear_modifier = { INPUT_PARAMETER = steppe } 
			modifier = {
				add = 50
                portrait_low_nobles_clothing_trigger = {
                    CULTURE_INPUT = steppe
                }
			}
		}
	}

	steppe_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = steppe_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_high_nobles_headgear_trigger = {
                    CULTURE_INPUT = steppe
                }   
			}
		}
	}

	steppe_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = steppe_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				OR = {
					portrait_imperial_trigger = {
						CULTURE_INPUT = steppe
					}   
					portrait_royalty_trigger = {
						CULTURE_INPUT = steppe
					}   
				}
			}
		}
	}

	ep1_steppe_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = ep1_steppe_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                OR = {
					portrait_imperial_trigger = {
						CULTURE_INPUT = steppe
					}   
					portrait_royalty_trigger = {
						CULTURE_INPUT = steppe
					}   
				}
			}
			modifier = {
				factor = 0
				NOT = {
					has_ep1_dlc_trigger = yes
				}
			}
		}
	}

## Northern Pagans ##

	northern_commoners = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = northern_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 70
                portrait_commoner_headgear_fallback_trigger = {
                    CULTURE_INPUT = northern
                }
			}
			modifier = {
				add = 30
                portrait_commoner_clothing_trigger = {
                    CULTURE_INPUT = northern
                }
			}
		}
	}

	northern_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = northern_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			court_fashion_level_4_headgear_modifier = { INPUT_PARAMETER = northern } 
			modifier = {
				add = 50
				OR = {
	                portrait_low_nobles_clothing_trigger = {
	                    CULTURE_INPUT = northern
	                }
				}
			}
		}
	}

	northern_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = northern_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_high_nobles_headgear_trigger = {
                    CULTURE_INPUT = northern
                }   
			}
		}
	}

	northern_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = northern_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_royalty_trigger = {
                    CULTURE_INPUT = northern
                }
			}
		}
	}

## FP2 Iberian ##
	fp2_iberian_muslim_commoners = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = fp2_muslim_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 80
                portrait_commoner_headgear_fallback_trigger = {
                    CULTURE_INPUT = fp2_iberian_muslim
                }
			}
			modifier = {
				add = 41 # Slightly higher
				portrait_commoner_no_mayors_trigger = {
                    CULTURE_INPUT = fp2_iberian_muslim
                }
			}
		}
	}

	fp2_iberian_muslim_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = fp2_muslim_low_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			court_fashion_level_4_headgear_modifier = { INPUT_PARAMETER = fp2_iberian_muslim } 
			modifier = {
				add = 51 # Slightly higher
                portrait_low_nobles_clothing_trigger = {
                    CULTURE_INPUT = fp2_iberian_muslim
                }
			}
		}
	}

	fp2_iberian_muslim_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = fp2_muslim_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 51 # Slightly higher
                portrait_high_nobles_headgear_trigger = {
                    CULTURE_INPUT = fp2_iberian_muslim
                }   
			}
		}
	}

	fp2_iberian_muslim_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = fp2_muslim_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 51 # Slightly higher
                portrait_royalty_trigger = {
                    CULTURE_INPUT = fp2_iberian_muslim
                }  
			}
		}
	}

	fp2_iberian_christian_commoners = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = fp2_christian_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		outfit_tags = { iberian_christian_shrimp_wrap }
		weight = {
			base = 0
			modifier = {
				add = 80
                portrait_commoner_headgear_fallback_trigger = {
                    CULTURE_INPUT = fp2_iberian_christian
                }
			}
			modifier = {
				add = 41 # Slightly higher
                portrait_commoner_clothing_trigger = {  
                    CULTURE_INPUT = fp2_iberian_christian 
                }
			}
		}
	}

	fp2_iberian_christian_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = fp2_christian_low_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			court_fashion_level_4_headgear_modifier = { INPUT_PARAMETER = fp2_iberian_christian } 
			modifier = {
				add = 60 # Slightly higher
                portrait_low_nobles_clothing_trigger = {
                    CULTURE_INPUT = fp2_iberian_christian
                }
			}
            modifier = {
                factor = 0       # Should NOT show up if EP2 is active and we're not in the right era
                has_ep2_dlc_trigger = yes   
                portrait_era1_trigger = yes 
            }
		}
	}

	fp2_iberian_christian_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = fp2_christian_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 60 # Slightly higher
                portrait_high_nobles_headgear_trigger = {
                    CULTURE_INPUT = fp2_iberian_christian
                } 
			}
            modifier = {
                factor = 0       # Should NOT show up if EP2 is active and we're not in the right era
                has_ep2_dlc_trigger = yes   
                portrait_era1_trigger = yes 
            }
		}
	}

	fp2_iberian_christian_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = fp2_christian_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 51 # Slightly higher
                portrait_royalty_trigger = {
                    CULTURE_INPUT = fp2_iberian_christian
                }  
			}
            modifier = {
                factor = 0       # Should NOT show up if EP2 is active and we're not in the right era
                has_ep2_dlc_trigger = yes   
                portrait_era1_trigger = yes 
            }
		}
	}

## FP1 NORSE ##

	fp1_norse_commoners = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = fp1_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 80
                portrait_commoner_headgear_fallback_trigger = {
                    CULTURE_INPUT = fp1_norse
                }
			}
			modifier = {
				add = 41 # Slightly higher
                portrait_commoner_clothing_trigger = {  
                    CULTURE_INPUT = fp1_norse 
                }
			}
		}
	}

	fp1_norse_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = fp1_low_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			court_fashion_level_4_headgear_modifier = { INPUT_PARAMETER = fp1_norse } 
			modifier = {
				add = 51 # Slightly higher
                portrait_low_nobles_clothing_trigger = {
                    CULTURE_INPUT = fp1_norse
                }
			}
		}
	}

	fp1_norse_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = fp1_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 51 # Slightly higher
                portrait_high_nobles_headgear_trigger = {
                    CULTURE_INPUT = fp1_norse
                }   
			}
		}
	}

	fp1_norse_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = fp1_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 51 # Slightly higher
                portrait_royalty_trigger = {
                    CULTURE_INPUT = fp1_norse
                }   
			}
		}
	}

	fp1_norse_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = fp1_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 100 # pick over northern
                portrait_imperial_trigger = {
                    CULTURE_INPUT = fp1_norse 
                }
			}
		}
	}

## Sub-Saharan Africans ##

	african_commoners = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = sub_saharan_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_commoner_headgear_fallback_trigger = {
                    CULTURE_INPUT = african
                }
			}
			modifier = { # Non-european jesters should not use the jester hat
				add = 1000
                portrait_jester_trigger = {  
                    CULTURE_INPUT = african 
                }
			}
			modifier = {
				add = 50
                portrait_commoner_clothing_trigger = {  
                    CULTURE_INPUT = african 
                }
			}
		}
	}

	sub_saharan_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = sub_saharan_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
                portrait_high_nobles_headgear_trigger = {
                    CULTURE_INPUT = african
                }   
			}
		}
	}

	sub_saharan_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = sub_saharan_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				portrait_royalty_african_headgear_trigger = yes
			}
		}
	}

	ep1_sub_saharan_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = ep1_sub_saharan_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				portrait_royalty_african_headgear_trigger = yes
			}
			modifier = {
				factor = 0
				NOT = {
					has_ep1_dlc_trigger = yes
				}
			}
		}
	}

	sub_saharan_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = sub_saharan_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}
		weight = {
			base = 0
			modifier = {
				add = 50
				portrait_imperial_nobles_headgear_trigger = {
					CULTURE_INPUT = african
				}
			}
		}
	}

		## China ##

	chinese_commoners = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_common
				range = { 0 1 } # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 80
				has_trait = peasant_leader
				OR = {
					is_ruler = no
					is_leading_faction_type = peasant_faction
					AND = {
						is_ruler = yes
						is_landed = no
						OR = {
							government_has_flag = government_is_feudal
							government_has_flag = government_is_clan
						}
					}
				}
				portrait_chinese_clothing_trigger = yes
			}
			modifier = {
				add = 50
				highest_held_title_tier < tier_county
				NOR = {
					AND = {
						exists = primary_spouse
						primary_spouse = {
						highest_held_title_tier > tier_county
						}
					}
					government_has_flag = government_is_republic
					AND = { is_ruler = yes government_has_flag = government_is_theocracy }
				}
				portrait_chinese_clothing_trigger = yes
			}
		}
	}

	chinese_mayors = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 60
				highest_held_title_tier < tier_county
				government_has_flag = government_is_republic
				portrait_chinese_clothing_trigger = yes
			}
		}
	}

	chinese_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 100
				NOT = { government_has_flag = government_is_theocracy }
				NAND = {
					has_trait = peasant_leader
					OR = {
						is_ruler = no
						is_leading_faction_type = peasant_faction
						AND = {
							is_ruler = yes
							is_landed = no
							OR = {
								government_has_flag = government_is_feudal
								government_has_flag = government_is_clan
							}
						}
					}
				}
				OR = {
					portrait_chinese_clothing_trigger = yes
					AND = {
						exists = primary_spouse
						is_ruler = no
						primary_spouse = { portrait_chinese_clothing_trigger = yes }
					}
				}
				OR = {
					AND = {
						highest_held_title_tier = tier_county
						NOT = {
						AND = { is_ruler = yes government_has_flag = government_is_theocracy }
						}	
					}
					AND = {
						exists = primary_spouse
						OR = {
							is_ruler = no
							highest_held_title_tier = tier_barony
						}
						primary_spouse = {
							highest_held_title_tier = tier_county
							NOT = {
							AND = { is_ruler = yes government_has_flag = government_is_theocracy }
							}
						}
					}
				}

			}
		}
	}

	chinese_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_high_nobility
				range = { 0 1 } # For the randomness to work correctly
			}
		}		
		weight = {
			base = 0
			modifier = {
				add = 100
				NOT = { government_has_flag = government_is_theocracy }
				NAND = {
					has_trait = peasant_leader
					OR = {
						is_ruler = no
						is_leading_faction_type = peasant_faction
						AND = {
							is_ruler = yes
							is_landed = no
							OR = {
								government_has_flag = government_is_feudal
								government_has_flag = government_is_clan
							}
						}
					}
				}
				OR = {
					portrait_chinese_clothing_trigger = yes
					AND = {
						exists = primary_spouse
						is_ruler = no
						primary_spouse = { portrait_chinese_clothing_trigger = yes }
					}
				}
				OR = {
					AND = {
						OR = {
							highest_held_title_tier = tier_duchy
							AND = { is_ruler = yes government_has_flag = government_is_theocracy }
						}
						NOT = { AND = { is_ruler = yes government_has_flag = government_is_mercenary  } } # Blocked for mercenaries
					}
					AND = {
						exists = primary_spouse
						OR = {
							is_ruler = no
							highest_held_title_tier = tier_barony
						}
						primary_spouse = {
							OR = {
								highest_held_title_tier = tier_duchy
								AND = { is_ruler = yes government_has_flag = government_is_theocracy }
							}
						}
					}
				}

			}
		}
	}

	chinese_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_royalty
				range = { 0 1 } # For the randomness to work correctly
			}
		}		
		weight = {
			base = 0
			modifier = {
				add = 80
				NOT = { government_has_flag = government_is_theocracy }
				OR = {
					portrait_chinese_clothing_trigger = yes
					AND = {
						exists = primary_spouse
						is_ruler = no
						primary_spouse = { portrait_chinese_clothing_trigger = yes }
					}
				}
				NAND = {
					has_trait = peasant_leader
					OR = {
						is_ruler = no
						is_leading_faction_type = peasant_faction
						AND = {
							is_ruler = yes
							is_landed = no
							OR = {
								government_has_flag = government_is_feudal
								government_has_flag = government_is_clan
							}
						}
					}
				}
				OR = {
					AND = {
						OR = {
							highest_held_title_tier = tier_kingdom
							AND = { is_ruler = yes government_has_flag = government_is_theocracy }
						}
						NOT = { AND = { is_ruler = yes government_has_flag = government_is_mercenary  } } # Blocked for mercenaries
					}
					AND = {
						exists = primary_spouse
						OR = {
							is_ruler = no
							highest_held_title_tier = tier_barony
						}
						primary_spouse = {
							OR = {
								highest_held_title_tier = tier_kingdom
								AND = { is_ruler = yes government_has_flag = government_is_theocracy }
							}
							NOT = { AND = { is_ruler = yes government_has_flag = government_is_mercenary  } } # Blocked for mercenaries
						}
					}
				}
			}
		}
	}
	
	chinese_princes = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_prince
				range = { 0 1 } # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 50
				any_parent = { highest_held_title_tier = tier_empire }
				portrait_chinese_clothing_trigger = yes
				NOT = { has_character_flag = flag_song_clothing	}
			}
		}
	}
	
	chinese_imperial = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_imperial
				range = { 0 1 } # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 110
				OR = {
					highest_held_title_tier = tier_empire
					AND = {
						exists = primary_spouse
						is_female = yes
						primary_spouse = { highest_held_title_tier = tier_empire }
					}
				}
				NAND = {
					has_trait = peasant_leader
					OR = {
						is_ruler = no
						is_leading_faction_type = peasant_faction
						AND = {
							is_ruler = yes
							is_landed = no
							OR = {
								government_has_flag = government_is_feudal
								government_has_flag = government_is_clan
							}
						}
					}
				}
				NOR = {
					AND = { is_ruler = yes government_has_flag = government_is_mercenary  }
					government_has_flag = government_is_republic
					AND = { is_ruler = yes government_has_flag = government_is_theocracy }
				}
				portrait_chinese_wear_helmet_trigger = no
				OR = {
					has_primary_title = title:e_celestia
					portrait_chinese_clothing_trigger = yes
					AND = {
						exists = primary_spouse
						is_ruler = no
						primary_spouse = { portrait_chinese_clothing_trigger = yes }
					}
				}
			}
		}
	}

	chinese_song_headgear = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_song_headgear
				range = { 0 1 } # For the randomness to work correctly
			}
		}	
		weight = {
			base = -30
			modifier = {
				add = 30
				NAND = {
					has_trait = peasant_leader
					OR = {
						is_ruler = no
						is_leading_faction_type = peasant_faction
						AND = {
							is_ruler = yes
							is_landed = no
							OR = {
								government_has_flag = government_is_feudal
								government_has_flag = government_is_clan
							}
						}
					}
				}
				portrait_chinese_clothing_trigger = yes
				OR = {
					AND = {
						OR = {
							highest_held_title_tier = tier_duchy
							AND = { is_ruler = yes government_has_flag = government_is_theocracy }
						}
						NOT = { AND = { is_ruler = yes government_has_flag = government_is_mercenary  } } # Blocked for mercenaries
					}
					AND = {
						exists = primary_spouse
						OR = {
							is_ruler = no
							highest_held_title_tier = tier_barony
						}
						primary_spouse = {
							OR = {
								highest_held_title_tier = tier_duchy
								AND = { is_ruler = yes government_has_flag = government_is_theocracy }
							}
						}
					}
				}
			}
			modifier = {
				add = 170
				#current_date >= 960.1.1
				exists = this
				is_adult = yes
				OR = {
					has_character_flag = flag_song_clothing
					AND = {
				        exists = liege
				        liege = {
							AND = {
								has_title = title:e_celestia
								government_has_flag = government_is_celestial
								has_character_flag = flag_song_clothing
							}
				        }
				    }
				}
				portrait_chinese_wear_helmet_trigger = no
			}
			modifier = {
				add = -180
				exists = this
				NOR = {
					government_has_flag = government_is_bureau
					government_has_flag = government_is_celestial
				}
			}
		}
	}

	chinese_war = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = chinese_war
				range = { 0 1 } # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 170
				portrait_chinese_wear_helmet_trigger = yes
				portrait_chinese_clothing_trigger = yes
				NOR = {
					religion = religion:christianity_religion
				    AND = {
				        religion = religion:christianity_religion
				        government_has_flag = government_is_holy_order
				    }
				    AND = {
				        religion = religion:christianity_religion
				        is_landed = no
				        portrait_wear_armor_trigger = yes
				        exists = liege
				        liege = {
				            government_has_flag = government_is_holy_order
				        }
				    }
				    AND = {
				        religion = religion:christianity_religion
				        portrait_wear_armor_trigger = yes
				        OR = {
				            any_character_war = {
				                OR = {
				                    using_cb = undirected_great_holy_war
				                    using_cb = directed_great_holy_war
				                }
				                is_attacker = prev
				            }
				            any_liege_or_above = {
				                faith = prev.faith
				                any_character_war = {
				                    OR = {
				                        using_cb = undirected_great_holy_war
				                        using_cb = directed_great_holy_war
				                    }
				                    is_attacker = prev
				                }
				            }
				        }
				    }
				}
			}
		}
	}


	# Shogunate

	shogunate_no_headgear = {

		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = no_headgear
				range = { 0 1 } # For the randomness to work correctly
			}
		}	
		
		weight = {
			base = 0
			# No headgear for Japanese characters
			modifier = {
				add = 50
				OR = {
					portrait_yamato_clothing_trigger = yes
					portrait_ryukyu_clothing_trigger = yes
					portrait_ainu_clothing_trigger = yes
				}
			}
			modifier = {
				add = 50
				portrait_japanese_wear_armor_trigger = yes
			}
		}
	}

	shogunate_japanese_suieikan = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = shogunate_suieikan
				range = { 0 1 }
			}
		}
		
		weight = {
			base = 0
			modifier = {
				add = 50
				AND = {
					OR = {
						AND = {
							highest_held_title_tier >= tier_duchy
							OR = {
								government_has_flag = government_is_feudal
								government_has_flag = government_is_celestial
							}
						}
						has_title = title:d_gosho
						AND = {
							exists = court_owner
							court_owner = {
								highest_held_title_tier >= tier_kingdom
								#culture = { has_cultural_pillar = heritage_imperial_court }
							}
						}
						#culture = { has_cultural_pillar = heritage_imperial_court }
					}
					scope:age >= 16
					NOT = { portrait_wear_armor_trigger = yes }
					portrait_yamato_clothing_trigger = yes
				}
			}
			modifier = {
				add = 50
				AND = {
					scope:age >= 16
					shogunate_should_be_no_hair_trigger = no
					portrait_yamato_clothing_trigger = yes
				}
			}
		}
	}

## AUSTRONESIAN ##

	austronesian_commoners = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = mmjm_common
				value = 1  # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
			
			modifier = {
				add = 95
				has_trait = peasant_leader
				OR = {
					is_ruler = no
					is_leading_faction_type = peasant_faction
					AND = {
						is_ruler = yes
						is_landed = no
						OR = {
							government_has_flag = government_is_feudal
							government_has_flag = government_is_clan
						}
					}
				}
				portrait_austronesian_clothing_trigger = yes
			}
			
			modifier = {
				add = 40
				highest_held_title_tier < tier_county
				NOR = {
					AND = {
						exists = primary_spouse
						primary_spouse = {
							highest_held_title_tier > tier_county
						}
					}
					AND = {
						government_has_flag = government_is_republic
						primary_title.tier > 1
					}
					AND = { is_ruler = yes government_has_flag = government_is_theocracy }
				}
				portrait_austronesian_clothing_trigger = yes
			}
		}
	}

	austronesian_low_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = mmjm_nobility
				value = 1  # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
#			modifier = {
#				add = 100
#				OR = {
#					this = character:rajasa_13
#					this = character:rajasa_2
#				}
#			}				
			modifier = {
				add = 101
				OR = {
					AND = {
						highest_held_title_tier = tier_county
						NOR = {
							# has_dynasty = no
							AND = {
								government_has_flag = government_is_republic
								primary_title.tier > 1
							}
							AND = { is_ruler = yes government_has_flag = government_is_theocracy }
						}
						portrait_austronesian_clothing_trigger = yes
					}
					AND = {
						exists = primary_spouse
						OR = {
							is_ruler = no
							highest_held_title_tier = tier_barony
						}
						primary_spouse = {
							highest_held_title_tier = tier_county
							NOR = {
								# has_dynasty = no
								AND = {
									government_has_flag = government_is_republic
									primary_title.tier > 1
								}
								AND = { is_ruler = yes government_has_flag = government_is_theocracy }
							}
							portrait_austronesian_clothing_spouse_trigger = yes
						}
					}
				}

			}
		}
	}

	austronesian_high_nobles = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = mmjm_nobility
				value = 1  # For the randomness to work correctly
			}
		}		
		weight = {
			base = 0	
#			modifier = {
#				add = 0
#				OR = {
#					this = character:rajasa_6
#				}
#			}				
			modifier = {
				add = 101
				OR = {
					AND = {
						OR = {
							highest_held_title_tier = tier_duchy
							AND = {
								government_has_flag = government_is_republic
								primary_title.tier > 1
							}
							AND = { is_ruler = yes government_has_flag = government_is_theocracy }
						}
						NOT = { AND = { is_ruler = yes government_has_flag = government_is_mercenary  } } # Blocked for mercenaries
						portrait_austronesian_clothing_trigger = yes
					}
					AND = {
						exists = primary_spouse
						OR = {
							is_ruler = no
							highest_held_title_tier = tier_barony
						}
						primary_spouse = {
							OR = {
								highest_held_title_tier = tier_duchy
								AND = {
									government_has_flag = government_is_republic
									primary_title.tier > 1
								}
								AND = { is_ruler = yes government_has_flag = government_is_theocracy }
							}
							portrait_austronesian_clothing_spouse_trigger = yes
						}
					}
				}

			}	
		}
	}

	austronesian_royalty = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = mmjm_royalty
				value = 1  # For the randomness to work correctly
			}
		}		
		weight = {
			base = 0
				
#			modifier = {
#				add = 101
#				OR = {
#					this = character:rajasa_5
#					AND = {
#						this = character:rajasa_4
#						NOT = { has_global_variable = variable_mmjm_ken_dedes_bathing }
#					}
#					AND = {
#						this = character:rajasa_1
#						NOT = { has_global_variable = variable_mmjm_ken_angrok_common }
#					}
#				}
#			}		
			
			modifier = {
				add = 101
				OR = {
					AND = {
						highest_held_title_tier >= tier_kingdom
						NOR = {
							AND = {
								government_has_flag = government_is_republic
								primary_title.tier > 1
							}
							AND = { is_ruler = yes government_has_flag = government_is_theocracy }
						}
						portrait_austronesian_clothing_trigger = yes
					}
					AND = {
						exists = primary_spouse
						OR = {
							is_ruler = no
							highest_held_title_tier = tier_barony
						}
						primary_spouse = {
							highest_held_title_tier >= tier_kingdom
							NOR = {
								AND = {
								government_has_flag = government_is_republic
									primary_title.tier > 1
								}
								AND = { is_ruler = yes government_has_flag = government_is_theocracy }
							}
							portrait_austronesian_clothing_spouse_trigger = yes
						}
					}
				}			
			}
		}
	}

	austronesian_war = {
		dna_modifiers = {
			accessory = {
				mode = add
				gene = headgear
				template = indian_war
				value = 1  # For the randomness to work correctly
			}
		}	
		weight = {
			base = 0
			modifier = {
				add = 101
				portrait_wear_helmet_trigger = yes
				portrait_austronesian_clothing_trigger = yes

			}
		}
	}	
}
